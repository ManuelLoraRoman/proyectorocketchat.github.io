<!DOCTYPE html><html><head><head> <!-- Include Meta Tags Here --><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="viewport" content="width=device-width, height=device-height, initial-scale=1 user-scalable=no, shrink-to-fit=no"><meta content='#000000' name='theme-color'/><meta name="keywords" content="Site, Rocket.Chat, Slack, Communication"><title>Rocket.Chat | Instalación mediante Docker-Compose</title><!-- Open Graph general (Facebook, Pinterest & Google+) --><meta name="og:title" content="Rocket.Chat | Instalación mediante Docker-Compose"><meta name="og:description" content="Este post tratará la instalación de Rocket.Chat sobre Docker con la utilidad de dockercompose."><meta name="og:image" content="/assets/images/dockercompose-image.jpg"><meta name="og:image:alt" content="Rocket.Chat | Instalación mediante Docker-Compose"><meta name="og:url" content="/blog/dockercompose-post"><meta name="article:author" content="https://www.facebook.com/Manu Lora Roman"><meta name="og:site_name" content="Rocket.Chat | Instalación mediante Docker-Compose"><meta name="og:type" content="website"> <!-- Twitter --><meta property="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Rocket.Chat | Instalación mediante Docker-Compose"><meta name="twitter:description" content="Este post tratará la instalación de Rocket.Chat sobre Docker con la utilidad de dockercompose."><meta name="twitter:site" content="@ManuelLoraRoman"><meta name="twitter:creator" content="@ManuelLoraRoman"><meta name="twitter:image:src" content="/assets/images/dockercompose-image.jpg"> <!-- Search Engine --><meta name="description" content="Este post tratará la instalación de Rocket.Chat sobre Docker con la utilidad de dockercompose."><meta name="image" content="/assets/images/dockercompose-image.jpg"> <!-- Schema.org for Google --><meta itemprop="name" content="Rocket.Chat | Instalación mediante Docker-Compose"><meta name="author" content="ManuelLoraRoman"/><meta itemprop="description" content="Este post tratará la instalación de Rocket.Chat sobre Docker con la utilidad de dockercompose."><meta itemprop="image" content="/assets/images/dockercompose-image.jpg"> <!-- Global site tag (gtag.js) - Google Analytics --> <script async src="https://www.googletagmanager.com/gtag/js?id="></script> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', ''); </script><title>Rocket.Chat</title><link rel="stylesheet" href="/assets/css/style.css"> <script src="https://kit.fontawesome.com/6a97161b76.js" crossorigin="anonymous"></script><link rel="shortcut icon" href="/assets/images/favicon-16x16.png" type="image/x-icon"></head></head><body><nav class="navbar is-black is-fixed-top" role="navigation" aria-label="main navigation" id="navbar"><div class="container"> <!-- logo or branding image on left side --><div class="navbar-brand"> <a class="navbar-item" href="/"> <strong>Rocket.Chat</strong> </a><div class="navbar-burger" data-target="navbar-menu"> <span></span> <span></span> <span></span></div></div><!-- children of navbar-menu must be navbar-start and/or navbar-end --><div class="navbar-menu has-background-black" id="navbar-menu"> <!-- navbar items | left side --> <!--<div class="navbar-start"></div>--> <!-- navbar items | right side --><div class="navbar-end"> <a class="navbar-item " href="/">HOME</a> <a class="navbar-item" href="/#about">ABOUT</a> <a class="navbar-item" href="/#contact">CONTACT</a> <a class="navbar-item " href="/blog">BLOG</a><div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link"> MORE </a><div class="navbar-dropdown has-background-black is-left"> <a href="/project" class="navbar-item has-text-grey-light "> Projects </a> <a href="/test-page" class="navbar-item has-text-grey-light "> Test Page </a> <!--<hr class="navbar-divider"> <a class="navbar-item"> Report an issue </a> --></div></div></div></div></div></nav><!-- Bulma Navbar JS --> <script> document.addEventListener('DOMContentLoaded', function () { /* Get all "navbar-burger" elements */ var $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0); /* Check if there are any navbar burgers */ if ($navbarBurgers.length > 0) { /* Add a click event on each of them */ $navbarBurgers.forEach(function ($el) { $el.addEventListener('click', function () { /* Get the target from the "data-target" attribute */ var target = $el.dataset.target; var $target = document.getElementById(target); /* Toggle the class on both the "navbar-burger" and the "navbar-menu" */ $el.classList.toggle('is-active'); $target.classList.toggle('is-active'); }); }); } }); </script><section class="hero is-fullheight has-text-centered" id="post"><div class="hero-body"><div class="container"> <a href="/blog/dockercompose-post" class="has-text-black" id="title"><h1 class="title has-text-centered is-2 has-text-weight-semibold ">Instalación mediante Docker-Compose</h1></a><hr class="has-background-black"><div class="columns is-variable is-5"><div class="column is-6"><figure class="image is-16by9 has-shadow"> <img src="/assets/images/dockercompose-image.jpg" alt="" id="post-image"></figure></div><div class="subtitle column is-5 has-text-left-desktop has-text-left-fullhd has-text-left-tablet has-text-center-mobile"><p id="description" class="content is-small has-text-weight-medium is-uppercase">Este post tratará la instalación de Rocket.Chat sobre Docker con la utilidad de dockercompose.</p><p class="subtitle is-6 is-uppercase has-text-weight-normal has-text-black-ter">Published on <b>April 15, 2021</b> by <a href="https://github.com/ManuelLoraRoman/" target="_blank"><b class="has-text-link"><u>ManuelLoraRoman</u></b> </a></p><p class="subtitle is-uppercase"> <i class="fas fa-tags"></i> <span class="tag is-link">Docker</span> <span class="tag is-link">dockercompose</span> <span class="tag is-link">Rocket.Chat</span> <span class="tag is-link">Installation</span></p><p class="subtitle is-uppercase"><i class="fas fa-clock"></i> <b class="has-text-link"> 3 min </b>READ</p></div></div><div class="content has-text-justified-desktop has-text-justified-fullhd has-text-justified has-text-justified-tablet has-text-left-mobile"><p><p>Es posible, como hemos visto en clase, que se puede automatizar el proceso de creación de contenedores mediante un fichero <em>.yml</em>. Por lo tanto, vamos a crear ese fichero con el siguiente contenido:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: '2'

services:
  rocketchat:
    image: rocketchat/rocket.chat:latest
    command: &gt;
      bash -c
        "for i in `seq 1 30`; do
          node main.js &amp;&amp;
          s=$$? &amp;&amp; break || s=$$?;
          echo \"Tried $$i times. Waiting 5 secs...\";
          sleep 5;
        done; (exit $$s)"
    restart: unless-stopped
    volumes:
      - ./uploads:/app/uploads
    environment:
      - PORT=3000
      - ROOT_URL=http://localhost:3000
      - MONGO_URL=mongodb://mongo:27017/rocketchat
      - MONGO_OPLOG_URL=mongodb://mongo:27017/local
      - MAIL_URL=smtp://smtp.email
#       - HTTP_PROXY=http://proxy.domain.com
#       - HTTPS_PROXY=http://proxy.domain.com
    depends_on:
      - mongo
    ports:
      - 3000:3000
    labels:
      - "traefik.backend=rocketchat"
      - "traefik.frontend.rule=Host: your.domain.tld"

  mongo:
    image: mongo:4.0
    restart: unless-stopped
    volumes:
     - ./data/db:/data/db
     #- ./data/dump:/dump
    command: mongod --smallfiles --oplogSize 128 --replSet rs0 --storageEngine=mmapv1
    labels:
      - "traefik.enable=false"

  # this container's job is just run the command to initialize the replica set.
  # it will run the command and remove himself (it will not stay running)
  mongo-init-replica:
    image: mongo:4.0
    command: &gt;
      bash -c
        "for i in `seq 1 30`; do
          mongo mongo/rocketchat --eval \"
            rs.initiate({
              _id: 'rs0',
              members: [ { _id: 0, host: 'localhost:27017' } ]})\" &amp;&amp;
          s=$$? &amp;&amp; break || s=$$?;
          echo \"Tried $$i times. Waiting 5 secs...\";
          sleep 5;
        done; (exit $$s)"
    depends_on:
      - mongo

  # hubot, the popular chatbot (add the bot user first and change the password before starting this imag$
  hubot:
    image: rocketchat/hubot-rocketchat:latest
    restart: unless-stopped
    environment:
      - ROCKETCHAT_URL=rocketchat:3000
      - ROCKETCHAT_ROOM=GENERAL
      - ROCKETCHAT_USER=bot
      - ROCKETCHAT_PASSWORD=botpassword
      - BOT_NAME=bot
  # you can add more scripts as you'd like here, they need to be installable by npm
      - EXTERNAL_SCRIPTS=hubot-help,hubot-seen,hubot-links,hubot-diagnostics
    depends_on:
      - rocketchat
    labels:
      - "traefik.enable=false"
    volumes:
      - ./scripts:/home/hubot/scripts
  # this is used to expose the hubot port for notifications on the host on port 3001, e.g. for hubot-jen$
    ports:
      - 3001:8080

  #traefik:
  #  image: traefik:latest
  #  restart: unless-stopped
  #  command: &gt;
  #    traefik
  #     --docker
  #     --acme=true
  #     --acme.domains='your.domain.tld'
  #     --acme.email='your@email.tld'
  #     --acme.entrypoint=https
  #     --acme.storagefile=acme.json
  #     --defaultentrypoints=http
  #     --defaultentrypoints=https
  #     --entryPoints='Name:http Address::80 Redirect.EntryPoint:https'
  #     --entryPoints='Name:https Address::443 TLS.Certificates:'
  #  ports:
  #    - 80:80
  #    - 443:443
  #  volumes:
  #    - /var/run/docker.sock:/var/run/docker.sock

</code></pre></div></div><p><br /> Este fichero dockercompose realizará lo siguiente:</p><ul><li><p>De primeras, inicia el servicio de <em>mongo</em>.</p></li><li><p>Después inicia otro servicio llamado <em>mongo-init-replica</em>, que esperará a que el servicio de mongo esté listo, para conectarse a él e inicializarlo.</p></li><li><p>Por último, inicia el servicio de Rocket.Chat, que al igual que el anterior servicio, esperará a que <em>mongo</em> esté listo.</p></li></ul><p>Para iniciar el escenario que hemos montado, vamos a ejecutar el siguiente comando:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose up -d
</code></pre></div></div><p><br /></p><div align="center"><img src="/assets/images/despliegue-compose.gif" /></div><p><br /> Podemos ver las características del despliegue: <br /></p><div align="center"><img src="/assets/images/docker-ps.gif" /></div><p><br /></p><p>Y ya tendríamos nuestra aplicación de Rocket.Chat funcionando. <br /></p><p>En caso de querer manejar logs y demás, podemos descomentar las líneas del montaje de volúmenes.</p><p>También es posible instalar Rocket.Chat en alta disponibilidad con un replicaset de <em>Mongodb</em> como backend, pero esta es una opción a tener en cuenta más adelante.</p><p>Una vez ya desplegado, veremos la IP de acceso de la máquina deploy_rocketchat_1 (en mi caso, 172.18.0.3) y accederemos mediante el navegador:</p><p><br /></p><div align="center"><img src="/assets/images/acceso-docker.gif" /></div><p><br /></p><p>Y una vez en la página, podemos iniciar sesión de manera normal:</p><p><br /></p><div align="center"><img src="/assets/images/inicio-sesion.gif" /></div><p><br /></p><p>A continuación, vamos a pasar al apartado de conexión de usuario.</p><div> <span style="margin-right:980px;text-align:left;color:blue" onclick="document.location.href = 'systemd-post'; return false">&lt; Instalación mediante systemd</span> <span style="margin-left:0px;float:right;color:blue" onclick="document.location.href = 'user-post'; return false">Conexiones y usuarios &gt;</span></div></p></div><div class="disqus-comments" id="disqus_thread"></div></div></div></section><footer id="footer"> <!--Footer Button--><div class="container has-text-centered has-background-grey-darker" id="backtotop"> <a class="has-text-white" onclick="window.scroll(0,0)">BACK TO TOP</a></div><!--Footer Main Section--><div class="has-background-grey-darker"><div class="container columns"> <!--Name Section--><div class="column has-text-left-desktop has-text-centered-mobile"> <a href="/#about"><div class="columns"><div class="column is-one-fifth-desktop is-one-fifth-fullhd is-one-quarter-tablet"><figure class="image is-64x64"> <img class="is-rounded" src="https://pbs.twimg.com/profile_images/924861277956173824/1x1O3l3v_400x400.jpg"></figure></div><div class="column is-marginless"><h5 class="has-text-grey-lighter">ManuelLoraRoman</h5><div class="content has-text-grey"><p>Administrador de Sistemas Informáticos en Red. DevOps</p></div></div></div></a></div><!--Link Section--><div class="column has-text-white"><h3>More Links</h3><li> <a href="/test-page">Test Page</a></li><li> <a target="_blank" href="/feed.xml">Subscribe via RSS</a></li></div><!--Blog-post Section--><div class="column has-text-white"><h3>Recent Posts</h3><li> <a href="/blog/proxy-post">Proxy inverso y Rocket.Chat</a></li><li> <a href="/blog/certificate-post">Cumplimiento de Rocket.Chat</a></li><li> <a href="/blog/ldap-post">Configuración de LDAP</a></li></div></div></div><div class="has-background-black has-text-centered has-text-white" id="credits"> <i class="far fa-copyright"></i> 2021 | <a href="https://github.com/thedevslot/WhatATheme" target="_blank" rel="noopener noreferrer">WhatATheme</a> - A Theme made with <i class="fas fa-heart has-text-danger"></i> by <a href="https://www.twitter.com/thedevslot" target="_blank" rel="noopener noreferrer">TheDevsLot</a> Powered by <a href="https://jekyllrb.com/" target="_blank">Jekyll</a></div></footer></body><script> /** * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS. * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/ /* var disqus_config = function () { this.page.url = PAGE_URL; Replace PAGE_URL with your page's canonical URL variable this.page.identifier = PAGE_IDENTIFIER; Replace PAGE_IDENTIFIER with your page's unique identifier variable }; */ (function () { /* DON'T EDIT BELOW THIS LINE */ var d = document, s = d.createElement('script'); s.src = 'https://thedevslot.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script></html>
