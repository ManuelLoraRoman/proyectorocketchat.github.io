<!DOCTYPE html><html><head><head> <!-- Include Meta Tags Here --><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="viewport" content="width=device-width, height=device-height, initial-scale=1 user-scalable=no, shrink-to-fit=no"><meta content='#000000' name='theme-color'/><meta name="keywords" content="Site, Rocket.Chat, Slack, Communication"><title>Rocket.Chat | Instalación de Rocket.Chat via systemd</title><!-- Open Graph general (Facebook, Pinterest & Google+) --><meta name="og:title" content="Rocket.Chat | Instalación de Rocket.Chat via systemd"><meta name="og:description" content="En este post se tratará de ver una de las maneras de instalación de nuestro proyecto con Rocket.Chat."><meta name="og:image" content="/assets/images/documetation-image.jpg"><meta name="og:image:alt" content="Rocket.Chat | Instalación de Rocket.Chat via systemd"><meta name="og:url" content="/blog/systemd-post"><meta name="article:author" content="https://www.facebook.com/Manu Lora Roman"><meta name="og:site_name" content="Rocket.Chat | Instalación de Rocket.Chat via systemd"><meta name="og:type" content="website"> <!-- Twitter --><meta property="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Rocket.Chat | Instalación de Rocket.Chat via systemd"><meta name="twitter:description" content="En este post se tratará de ver una de las maneras de instalación de nuestro proyecto con Rocket.Chat."><meta name="twitter:site" content="@ManuelLoraRoman"><meta name="twitter:creator" content="@ManuelLoraRoman"><meta name="twitter:image:src" content="/assets/images/documetation-image.jpg"> <!-- Search Engine --><meta name="description" content="En este post se tratará de ver una de las maneras de instalación de nuestro proyecto con Rocket.Chat."><meta name="image" content="/assets/images/documetation-image.jpg"> <!-- Schema.org for Google --><meta itemprop="name" content="Rocket.Chat | Instalación de Rocket.Chat via systemd"><meta name="author" content="ManuelLoraRoman"/><meta itemprop="description" content="En este post se tratará de ver una de las maneras de instalación de nuestro proyecto con Rocket.Chat."><meta itemprop="image" content="/assets/images/documetation-image.jpg"> <!-- Global site tag (gtag.js) - Google Analytics --> <script async src="https://www.googletagmanager.com/gtag/js?id="></script> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', ''); </script><title>Rocket.Chat</title><link rel="stylesheet" href="/assets/css/style.css"> <script src="https://kit.fontawesome.com/6a97161b76.js" crossorigin="anonymous"></script><link rel="shortcut icon" href="/assets/images/favicon-16x16.png" type="image/x-icon"></head></head><body><nav class="navbar is-black is-fixed-top" role="navigation" aria-label="main navigation" id="navbar"><div class="container"> <!-- logo or branding image on left side --><div class="navbar-brand"> <a class="navbar-item" href="/"> <strong>Rocket.Chat</strong> </a><div class="navbar-burger" data-target="navbar-menu"> <span></span> <span></span> <span></span></div></div><!-- children of navbar-menu must be navbar-start and/or navbar-end --><div class="navbar-menu has-background-black" id="navbar-menu"> <!-- navbar items | left side --> <!--<div class="navbar-start"></div>--> <!-- navbar items | right side --><div class="navbar-end"> <a class="navbar-item " href="/">HOME</a> <a class="navbar-item" href="/#about">ABOUT</a> <a class="navbar-item" href="/#contact">CONTACT</a> <a class="navbar-item " href="/blog">BLOG</a><div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link"> MORE </a><div class="navbar-dropdown has-background-black is-left"> <a href="/project" class="navbar-item has-text-grey-light "> Projects </a> <a href="/test-page" class="navbar-item has-text-grey-light "> Test Page </a> <!--<hr class="navbar-divider"> <a class="navbar-item"> Report an issue </a> --></div></div></div></div></div></nav><!-- Bulma Navbar JS --> <script> document.addEventListener('DOMContentLoaded', function () { /* Get all "navbar-burger" elements */ var $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0); /* Check if there are any navbar burgers */ if ($navbarBurgers.length > 0) { /* Add a click event on each of them */ $navbarBurgers.forEach(function ($el) { $el.addEventListener('click', function () { /* Get the target from the "data-target" attribute */ var target = $el.dataset.target; var $target = document.getElementById(target); /* Toggle the class on both the "navbar-burger" and the "navbar-menu" */ $el.classList.toggle('is-active'); $target.classList.toggle('is-active'); }); }); } }); </script><section class="hero is-fullheight has-text-centered" id="post"><div class="hero-body"><div class="container"> <a href="/blog/systemd-post" class="has-text-black" id="title"><h1 class="title has-text-centered is-2 has-text-weight-semibold ">Instalación de Rocket.Chat via systemd</h1></a><hr class="has-background-black"><div class="columns is-variable is-5"><div class="column is-6"><figure class="image is-16by9 has-shadow"> <img src="/assets/images/documetation-image.jpg" alt="" id="post-image"></figure></div><div class="subtitle column is-5 has-text-left-desktop has-text-left-fullhd has-text-left-tablet has-text-center-mobile"><p id="description" class="content is-small has-text-weight-medium is-uppercase">En este post se tratará de ver una de las maneras de instalación de nuestro proyecto con Rocket.Chat.</p><p class="subtitle is-6 is-uppercase has-text-weight-normal has-text-black-ter">Published on <b>April 18, 2021</b> by <a href="https://github.com/ManuelLoraRoman/" target="_blank"><b class="has-text-link"><u>ManuelLoraRoman</u></b> </a></p><p class="subtitle is-uppercase"> <i class="fas fa-tags"></i> <span class="tag is-link">Documentation</span> <span class="tag is-link">post</span> <span class="tag is-link">general</span></p><p class="subtitle is-uppercase"><i class="fas fa-clock"></i> <b class="has-text-link"> 2 min </b>READ</p></div></div><div class="content has-text-justified-desktop has-text-justified-fullhd has-text-justified has-text-justified-tablet has-text-left-mobile"><p><p>Rocket.Chat dispone de tres imágenes oficiales, siendo la versión <em>stable</em> la que en principio vamos a utilizar.</p><p>Para bajarse alguna de las imagénes, vamos a ejecutar lo siguiente:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker pull rocket.chat
</code></pre></div></div><p><br /> Demo de la descarga:</p><p><img src="/assets/images/descarga-imagen.gif" width="480" height="259" frameborder="0" /></p><p>Una vez bajada dicha imagen, en caso de querer ejecutar Rocket.Chat sobre <em>systemd</em> vamos a seguir los siguientes pasos:</p><ul><li>Primero creamos una red en Docker:</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker network create rocketchat_default
</code></pre></div></div><ul><li><p>Después, creamos dos servicios: el primero será el servicio para Mongodb y el otro, el servicio de Rocket.Chat.</p><ul><li>mongo.service</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  [Unit]
  Description=mongo
  Requires=docker.service
  After=docker.service
	
  [Service]
  EnvironmentFile=/etc/mongo				&lt;-- ficheros del servicio
  User=manuel
  Restart=always
  TimeoutStartSec=0
  ExecStartPre=-/usr/bin/docker kill mongo
  ExecStartPre=-/usr/bin/docker rm mongo
  ExecStartPre=-/usr/bin/docker pull mongo:3.2
	
	
  ExecStart=/usr/bin/docker run \
      --name mongo \
      -v /media/manuel/Datos1/PROYECTO/mongo:/data/db \		&lt;-- ruta del volumen para Mongodb
      --net=rocketchat_default \
      mongo:3.2 \
      mongod --smallfiles --oplogSize 128 --replSet rs0 --storageEngine=mmapv1
	
  ExecStop=-/usr/bin/docker kill mongo
  ExecStop=-/usr/bin/docker rm mongo
</code></pre></div></div><p><br /></p><ul><li>rocketchat.service</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  [Unit]
  Description=rocketchat
  Requires=docker.service
  Requires=mongo.service
  After=docker.service
  After=mongo.service
	
  [Service]
  EnvironmentFile=/etc/rocketchat				&lt;-- ficheros del servicio
  User=manuel						
  Restart=always
  TimeoutStartSec=0
  ExecStartPre=-/usr/bin/docker kill rocketchat
  ExecStartPre=-/usr/bin/docker rm rocketchat
  ExecStartPre=-/usr/bin/docker pull rocketchat/rocket.chat:latest
	
  ExecStart=/usr/bin/docker run \
      --name rocketchat \
      -v /media/manuel/Datos1/PROYECTO/rocketchat:/app/uploads \	&lt;-- donde subir ficheros
      -e MONGO_OPLOG_URL=mongodb://mongo:27017/local \
      -e MONGO_URL=mongodb://mongo:27017/rocketchat \
      -e ROOT_URL=https://sub.domain.xx \
      --link mongo:mongo \
      --net=rocketchat_default \
      --expose 3000 \
      rocketchat/rocket.chat:latest
	
  ExecStop=-/usr/bin/docker kill rocketchat
  ExecStop=-/usr/bin/docker rm rocketchat
</code></pre></div></div><p><br /></p></li><li><p>Creados ambos servicios, vamos a iniciar el de Mongodb y creamos el siguiente contenedor Docker:</p></li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run \
      --name mongo-init-replica \
      --link mongo:mongo \
      --rm \
      --net=rocketchat_default \
      mongo:3.2 \
      mongo mongo/rocketchat --eval "rs.initiate({ _id: 'rs0', members: [ { _id: 0, host: 'localhost:27017' } ]})"
</code></pre></div></div><p><br /> <img src="/assets/images/contenedor-mongo.gif" width="480" height="259" frameborder="0" /> <br /></p><ul><li>Por último, vamos a iniciar el servicio de Rocket.Chat creado anteriormente:</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo systemctl start rocketchat.service
</code></pre></div></div><p><br /></p><p>Con esto, ya tendriamos nuestro servicio Rocket.Chat funcionando en una máquina Docker, pero funcionando desde systemd.</p><p>Como última aclaración, en caso de tener un proxy inverso, nos debemos asegurar que está añadido en la red creada anteriormente. Para ello, debemos añadir la siguiente línea en el archivo <em>rocketchat.service</em>:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ExecStartPre=-/usr/bin/docker network connect rocketchat_default Nginx
</code></pre></div></div><p>Ahora pasaremos a otro tipo de instalación.</p><div> <span style="margin-right:980px;text-align:left;color:blue" onclick="document.location.href = 'introduction-post'; return false">&lt; Introducción</span> <span style="margin-left:0px;text-align:right;color:blue" onclick="document.location.href = 'dockercompose-post'; return false">Instalación Docker-compose &gt;</span></div></p></div><div class="disqus-comments" id="disqus_thread"></div></div></div></section><footer id="footer"> <!--Footer Button--><div class="container has-text-centered has-background-grey-darker" id="backtotop"> <a class="has-text-white" onclick="window.scroll(0,0)">BACK TO TOP</a></div><!--Footer Main Section--><div class="has-background-grey-darker"><div class="container columns"> <!--Name Section--><div class="column has-text-left-desktop has-text-centered-mobile"> <a href="/#about"><div class="columns"><div class="column is-one-fifth-desktop is-one-fifth-fullhd is-one-quarter-tablet"><figure class="image is-64x64"> <img class="is-rounded" src="https://pbs.twimg.com/profile_images/924861277956173824/1x1O3l3v_400x400.jpg"></figure></div><div class="column is-marginless"><h5 class="has-text-grey-lighter">ManuelLoraRoman</h5><div class="content has-text-grey"><p>Administrador de Sistemas Informáticos en Red. DevOps</p></div></div></div></a></div><!--Link Section--><div class="column has-text-white"><h3>More Links</h3><li> <a href="/test-page">Test Page</a></li><li> <a target="_blank" href="/feed.xml">Subscribe via RSS</a></li></div><!--Blog-post Section--><div class="column has-text-white"><h3>Recent Posts</h3><li> <a href="/blog/systemd-post">Instalación de Rocket.Chat via systemd</a></li><li> <a href="/blog/research-material-post">Sample Post</a></li><li> <a href="/blog/dockercompose-post">Sample Post</a></li></div></div></div><div class="has-background-black has-text-centered has-text-white" id="credits"> <i class="far fa-copyright"></i> 2021 | <a href="https://github.com/thedevslot/WhatATheme" target="_blank" rel="noopener noreferrer">WhatATheme</a> - A Theme made with <i class="fas fa-heart has-text-danger"></i> by <a href="https://www.twitter.com/thedevslot" target="_blank" rel="noopener noreferrer">TheDevsLot</a> Powered by <a href="https://jekyllrb.com/" target="_blank">Jekyll</a></div></footer></body><script> /** * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS. * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/ /* var disqus_config = function () { this.page.url = PAGE_URL; Replace PAGE_URL with your page's canonical URL variable this.page.identifier = PAGE_IDENTIFIER; Replace PAGE_IDENTIFIER with your page's unique identifier variable }; */ (function () { /* DON'T EDIT BELOW THIS LINE */ var d = document, s = d.createElement('script'); s.src = 'https://ManuelLoraRoman.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script></html>
